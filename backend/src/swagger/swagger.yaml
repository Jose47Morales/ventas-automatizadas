openapi: 3.0.3
info:
  title: Ventas Automatizadas API
  version: 1.0.0
  description: API REST para gestión de productos, órdenes, pagos y analíticas.

servers:
  - url: http://https://ventas-backend-gyyx.onrender.com/api
    description:  Servidor de producción

paths:
  ############################################################
  # PRODUCTS
  ############################################################
  /products:
    get:
      summary: Obtener todos los productos
      tags: [Products]
      responses:
        200:
          description: Lista de productos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'

    post:
      summary: Crear un nuevo producto
      tags: [Products]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        201:
          description: Producto creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'

  /products/{id}:
    get:
      summary: Obtener un producto por ID
      tags: [Products]
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        200:
          description: Producto encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        404:
          description: Producto no encontrado

    put:
      summary: Actualizar un producto
      tags: [Products]
      parameters:
        - $ref: '#/components/parameters/ProductId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        200:
          description: Producto actualizado
        404:
          description: Producto no encontrado

    delete:
      summary: Eliminar producto
      tags: [Products]
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        200:
          description: Producto eliminado
        404:
          description: Producto no encontrado

  ############################################################
  # ORDERS
  ############################################################
  /orders:
    get:
      summary: Obtener todas las órdenes
      tags: [Orders]
      responses:
        200:
          description: Lista de órdenes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'

    post:
      summary: Crear una orden
      tags: [Orders]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        201:
          description: Orden creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'

  /orders/{id}:
    get:
      summary: Obtener una orden por ID
      tags: [Orders]
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        200:
          description: Orden encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        404:
          description: No encontrada

    put:
      summary: Actualizar una orden
      tags: [Orders]
      parameters:
        - $ref: '#/components/parameters/OrderId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        200:
          description: Orden actualizada
        404:
          description: No encontrada

    delete:
      summary: Eliminar una orden
      tags: [Orders]
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        200:
          description: Orden eliminada
        404:
          description: No encontrada

  ############################################################
  # PAYMENTS
  ############################################################
  /payments:
    get:
      summary: Obtener todos los pagos
      tags: [Payments]
      responses:
        200:
          description: Lista de pagos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Payment'

    post:
      summary: Crear un pago
      tags: [Payments]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentInput'
      responses:
        201:
          description: Pago registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'

  /payments/{id}:
    get:
      summary: Obtener un pago por ID
      tags: [Payments]
      parameters:
        - $ref: '#/components/parameters/PaymentId'
      responses:
        200:
          description: Pago encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        404:
          description: No encontrado

    put:
      summary: Actualizar un pago
      tags: [Payments]
      parameters:
        - $ref: '#/components/parameters/PaymentId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentInput'
      responses:
        200:
          description: Pago actualizado
        404:
          description: No encontrado

    delete:
      summary: Eliminar un pago
      tags: [Payments]
      parameters:
        - $ref: '#/components/parameters/PaymentId'
      responses:
        200:
          description: Pago eliminado
        404:
          description: No encontrado

  ############################################################
  # ANALYTICS
  ############################################################
  /analytics:
    get:
      summary: Obtener todas las métricas
      tags: [Analytics]
      responses:
        200:
          description: Lista de métricas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Metric'

    post:
      summary: Crear una métrica
      tags: [Analytics]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MetricInput'
      responses:
        201:
          description: Métrica creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Metric'

  /analytics/{metric_type}:
    get:
      summary: Obtener métricas por tipo
      tags: [Analytics]
      parameters:
        - name: metric_type
          in: path
          required: true
          schema:
            type: string
          example: message_received
      responses:
        200:
          description: Lista filtrada de métricas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Metric'

############################################################
# COMPONENTS
############################################################
components:
  ############################################################
  # PARAMETERS
  ############################################################
  parameters:
    ProductId:
      name: id
      in: path
      required: true
      schema:
        type: integer
    OrderId:
      name: id
      in: path
      required: true
      schema:
        type: integer
    PaymentId:
      name: id
      in: path
      required: true
      schema:
        type: integer

  ############################################################
  # SCHEMAS
  ############################################################
  schemas:
    ########################################################
    # PRODUCTS
    ########################################################
    Product:
      type: object
      properties:
        id_producto:
          type: integer
        nombre:
          type: string
        descripcion:
          type: string
        precio:
          type: number
        stock:
          type: integer

    ProductInput:
      type: object
      required: [nombre, precio, stock]
      properties:
        nombre:
          type: string
        descripcion:
          type: string
        precio:
          type: number
        stock:
          type: integer

    ########################################################
    # ORDERS
    ########################################################
    Order:
      type: object
      properties:
        id:
          type: integer
        client_name:
          type: string
        client_phone:
          type: string
        product_id:
          type: integer
        quantity:
          type: integer
        total:
          type: number
        payment_status:
          type: string
        date:
          type: string
          format: date-time

    OrderInput:
      type: object
      required: [client_name, client_phone, product_id, quantity]
      properties:
        client_name:
          type: string
        client_phone:
          type: string
        product_id:
          type: integer
        quantity:
          type: integer
        total:
          type: number
        payment_status:
          type: string

    ########################################################
    # PAYMENTS
    ########################################################
    Payment:
      type: object
      properties:
        id:
          type: integer
        order_id:
          type: integer
        gateway:
          type: string
        confirmation_code:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time

    PaymentInput:
      type: object
      required: [order_id, gateway, confirmation_code, status]
      properties:
        order_id:
          type: integer
        gateway:
          type: string
        confirmation_code:
          type: string
        status:
          type: string

    ########################################################
    # ANALYTICS
    ########################################################
    Metric:
      type: object
      properties:
        id:
          type: integer
        metric_type:
          type: string
        value:
          type: number
        metadata:
          type: object
        created_at:
          type: string
          format: date-time

    MetricInput:
      type: object
      required: [metric_type, value]
      properties:
        metric_type:
          type: string
          example: message_received
        value:
          type: number
        metadata:
          type: object
          example:
            source: "whatsapp"
            campaign: "spring_sale"