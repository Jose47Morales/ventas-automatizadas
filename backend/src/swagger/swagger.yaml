openapi: 3.0.3

info:
  title: Ventas Automatizadas API
  version: 1.0.0
  description: API Backend para ventas automatizadas.

servers:
  - url: /api
    description: Dynamic server (Fly / Reserve Proxy)

tags:
  - name: Products
  - name: Orders
  - name: Payments
  - name: Analytics
  - name: Auth

paths:

  ############################################################
  # PRODUCTS
  ############################################################
  /products:
    get:
      summary: Obtener productos (paginado)
      tags: [Products]
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        200:
          description: Lista paginada de productos
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'

    post:
      summary: Crear producto
      tags: [Products]
      security: 
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $$ref: '#/components/schemas/ProductInput'
      responses:
        201:
          description: Producto creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'

  /products/{id}:
    get:
      summary: Obtener producto por ID
      tags: [Products]
      parameters:
        - $ref: '#/components/parameters/UUID'
      responses:
        200:
          description: Producto encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        404:
          description: No encontrado

    put:
      summary: Actualizar producto
      tags: [Products]
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        200:
          description: Producto actualizado

    delete:
      summary: Eliminar producto
      tags: [Products]
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UUID'
      responses:
        200:
          description: Producto eliminado

  ############################################################
  # ORDERS
  ############################################################
  /orders:
    get:
      summary: Obtener órdenes
      tags: [Orders]
      security:
        - BearerAuth: []
      responses:
        200:
          description: Lista de órdenes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'

    post:
      summary: Crear orden
      tags: [Orders]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        201:
          description: Orden creada

  /orders/{id}:
    get:
      summary: Obtener orden por ID
      tags: [Orders]
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UUID'
      responses:
        200:
          description: Orden encontrada

  ############################################################
  # PAYMENTS
  ############################################################
  /payments:
    post:
      summary: Registrar pago
      tags: [Payments]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentInput'
      responses:
        201:
          description: Pago registrado

  ############################################################
  # ANALYTICS
  ############################################################
  /analytics/{metric_type}:
    get:
      summary: Obtener métricas por tipo
      tags: [Analytics]
      parameters:
        - name: metric_type
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Métricas filtradas
          content:
            application/json':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Metric'

############################################################
# COMPONENTS
############################################################
components:

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    UUID:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
  
  schemas:

    Product:
      type: object
      properties:
        id:
          type: string
          format: uuid
        nombre:
          type: string
        precio:
          type: number
        stock:
          type: integer

    ProductInput:
      type: object
      required: [nombre, precio, stock]
      properties:
        nombre: 
          type: string
        precio:
          type: number
        stock:
          type: integer

    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        total:
          type: number
        status:
          type: string
        created_at:
          type: string
          format: date-time

    OrderInput:
      type: object
      required: [product_id, quantity]
      properties:
        product_id:
          type: string
          format: uuid
        quantity:
          type: integer

    PaymentInput:
      type: object
      required: [order_id, gateway, status]
      properties:
        order_id:
          type: string
          format: uuid
        gateway:
          type: string
        status:
          type: string

    Metric:
      type: object
      properties:
        id:
          type: string
          format: uuid
        metric_type:
          type: string
        value:
          type: number
        created_at:
          type: string
          format: date-time